<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="theme-color" content="#b91c1c"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="apple-mobile-web-app-title" content="Ap√©ro Catalan¬Æ"/>
  <title>Ap√©ro Catalan¬Æ</title>

  <style>
    :root{
      --red:#b91c1c;
      --red2:#991b1b;
      --bg:#0b0f14;
      --card:#ffffff;
      --muted:#6b7280;
      --shadow: 0 10px 25px rgba(0,0,0,.25);
      --radius: 18px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color:#111827;
    }

    /* --- Modal --- */
    .overlay{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      padding: 18px;
      background: rgba(0,0,0,.55);
      z-index: 9999;
    }
    .overlay.show{ display:flex; }

    .modal{
      width:min(980px, 100%);
      max-height: min(88vh, 820px);
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    .modalHeader{
      padding: 14px 16px 10px 16px;
      border-bottom: 1px solid rgba(0,0,0,.06);
      display:flex;
      align-items:flex-start;
      gap: 12px;
    }
    .modalHeader h2{
      margin:0;
      font-size: 22px;
      line-height: 1.1;
      font-weight: 800;
      letter-spacing: .2px;
    }
    .closeBtn{
      margin-left:auto;
      border:none;
      background: transparent;
      font-size: 24px;
      cursor:pointer;
      padding: 4px 8px;
      opacity:.7;
    }
    .closeBtn:hover{ opacity:1; }

    .subLine{
      margin-top:4px;
      font-size: 13px;
      color: var(--muted);
    }

    .infoBox{
      margin: 10px 16px 0 16px;
      border-radius: 14px;
      background: #f8fafc;
      border: 1px solid rgba(0,0,0,.06);
      padding: 10px 12px;
      font-size: 13px;
      color:#111827;
      line-height: 1.25;
    }
    .infoBox b{ display:block; margin-bottom: 2px; }

    .toolsRow{
      padding: 10px 16px 12px 16px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
    }

    .search{
      flex: 1 1 240px;
      display:flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border: 1px solid rgba(0,0,0,.1);
      border-radius: 999px;
      background:#fff;
    }
    .search input{
      width:100%;
      border:none; outline:none;
      font-size: 14px;
      background:transparent;
    }

    /* Tabs */
    .tabsWrap{
      padding: 0 16px 8px 16px;
      overflow-x:auto;
      -webkit-overflow-scrolling: touch;
    }
    .tabs{
      display:flex;
      gap:8px;
      white-space:nowrap;
      padding-bottom: 2px;
    }
    .tabBtn{
      border:none;
      cursor:pointer;
      padding: 7px 12px;
      font-size: 13px;
      border-radius: 999px;
      background:#f3f4f6;
      color:#111827;
      transition: .15s ease;
    }
    .tabBtn:hover{ background:#e5e7eb; }
    .tabBtn.active{
      background: var(--red);
      color:#fff;
    }

    .metaRow{
      padding: 0 16px 10px 16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size: 12px;
      color: var(--muted);
      gap: 10px;
    }
    .metaRow .callLine{
      color:#111827;
    }
    .metaRow .callLine b{
      color: var(--red);
    }

    /* Grid */
    .listArea{
      padding: 0 12px 14px 12px;
      overflow:auto;
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      padding: 0 4px 8px 4px;
    }
    @media (min-width: 720px){
      .grid{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }

    .card{
      border: 1px solid rgba(0,0,0,.08);
      border-radius: 16px;
      padding: 10px;
      background:#fff;
      display:flex;
      flex-direction:column;
      gap: 8px;
      min-height: 228px;
      overflow:hidden;
    }

    .topLine{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 8px;
      font-size: 12px;
      color: var(--muted);
      min-height: 16px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.08);
      background:#f8fafc;
      color:#111827;
      white-space:nowrap;
    }
    .dot{
      width:8px; height:8px; border-radius:999px;
      background:#9ca3af;
    }
    .dot.ok{ background:#16a34a; }
    .dot.ko{ background:#dc2626; }
    .badge.ok{ background:#ecfdf5; border-color: rgba(22,163,74,.25); }
    .badge.ko{ background:#fef2f2; border-color: rgba(220,38,38,.25); }

    .imgWrap{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 4px 2px;
      min-height: 118px;
    }
    .imgWrap img{
      max-width: 100%;
      max-height: 130px;
      object-fit: contain;
      display:block;
    }

    .name{
      font-weight: 800;
      font-size: 16px;
      line-height: 1.15;
      color:#111827;
      word-break: break-word;
    }

    .price{
      font-weight: 900;
      font-size: 18px;
      color: var(--red);
      display:flex;
      align-items:baseline;
      gap: 6px;
    }
    .price .eur{
      font-weight: 800;
      font-size: 14px;
      color: var(--red2);
    }

    .btn{
      margin-top:auto;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      padding: 10px 12px;
      border:none;
      border-radius: 12px;
      background: var(--red);
      color:#fff;
      font-weight: 800;
      cursor:pointer;
      font-size: 14px;
    }
    .btn:hover{ background: var(--red2); }
    .btn svg{ width: 16px; height: 16px; fill: currentColor; }

    /* Small helper */
    .hidden{ display:none !important; }
  </style>
</head>

<body>

  <!-- Example page (ton site). Un bouton peut ouvrir cette modale -->
  <div style="min-height:100vh; display:flex; align-items:center; justify-content:center; padding: 28px;">
    <button id="openModal" class="btn" style="max-width:320px;">Voir nos articles</button>
  </div>

  <!-- Modal -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Nos Articles">
      <div class="modalHeader">
        <div>
          <h2>Nos Articles</h2>
          <div class="subLine">Appelle pour commander.</div>
        </div>
        <button class="closeBtn" id="closeModal" aria-label="Fermer">√ó</button>
      </div>

      <div class="infoBox">
        <b>Disponibilit√©s des produits alcoolis√©s</b>
        Connect√©es en temps r√©el au stock du v√©hicule.
      </div>

      <div class="toolsRow">
        <div class="search">
          <span aria-hidden="true">üîé</span>
          <input id="searchInput" type="search" placeholder="Rechercher un produit‚Ä¶"/>
        </div>
      </div>

      <div class="tabsWrap">
        <div class="tabs" id="categoryTabs">
          <button class="tabBtn active" data-category="all">Tout</button>
          <button class="tabBtn" data-category="snacks">üçø Snacks</button>
          <button class="tabBtn" data-category="vodka">üç∏ Vodka</button>
          <button class="tabBtn" data-category="whisky">ü•É Whisky</button>
          <button class="tabBtn" data-category="rhum">üè¥‚Äç‚ò†Ô∏è Rhum</button>
          <button class="tabBtn" data-category="liqueurs">üçπ Liqueurs</button>
          <button class="tabBtn" data-category="gin">üåø Gin</button>
          <button class="tabBtn" data-category="tequila">üåµ Tequila</button>
          <button class="tabBtn" data-category="softs">ü•§ Softs</button>
          <button class="tabBtn" data-category="pastis">üü° Pastis</button>
          <button class="tabBtn" data-category="vin">üç∑ Vin</button>
          <button class="tabBtn" data-category="accessoires">üßä Accessoires</button>
        </div>
      </div>

      <div class="metaRow">
        <div id="resultInfo">‚Äî</div>
        <div class="callLine">Commande : <b>t√©l√©phone</b></div>
      </div>

      <div class="listArea">
        <div class="grid" id="grid"></div>
        <div style="padding: 0 6px 8px 6px; font-size: 12px; color: #6b7280;">
          Prix indicatifs ‚Ä¢ Le stock peut varier selon la nuit ‚Ä¢ Appelle pour confirmation et commande.
        </div>
      </div>
    </div>
  </div>

<script>
  // ====== CONFIG ======
  // Base images: d√©p√¥t stock / img
  // (si tu veux basculer sur jsDelivr, remplace la base par :
  // https://cdn.jsdelivr.net/gh/bullyto/stock@main/img/
  const STOCK_IMG_BASE = "https://raw.githubusercontent.com/bullyto/stock/main/img/";

  // Stock json (d√©pend de ton syst√®me d√©j√† en place)
  // Ici: on suppose que tu publies un snapshot accessible c√¥t√© stock,
  // si tu as d√©j√† une URL diff√©rente, remplace-l√†.
  const STOCK_SNAPSHOT_URL = "https://raw.githubusercontent.com/bullyto/stock/main/stock/_snapshot.json";

  // Cat√©gories consid√©r√©es "alcool" => on affiche dispo/rupture
  const ALCOHOL_CATS = new Set(["vodka","whisky","rhum","liqueurs","gin","tequila","pastis","vin"]);

  // ====== PRODUITS ======
  // IMPORTANT: image attendue = stock/img/<id>.png
  const products = {
    "snacks": [
      {"id":"cacahuette","name":"Cacahu√®tes","price":0.0},
      {"id":"bretzel","name":"Bretzel","price":0.0},
      {"id":"curly","name":"Curly","price":0.0},
      {"id":"chips","name":"Chips","price":0.0},
      {"id":"monster_munch","name":"Monster Munch","price":0.0},
      {"id":"dragibus","name":"Dragibus","price":0.0},
      {"id":"fraise_tagada","name":"Fraise Tagada","price":0.0}
    ],
    "vodka": [
      {"id":"poliakov","name":"Poliakov","price":29.0},
      {"id":"absolut","name":"Absolut","price":34.0},
      {"id":"ciroc_classic","name":"C√Æroc Classic","price":49.0},
      {"id":"ciroc_pomme","name":"C√Æroc Pomme","price":49.0},
      {"id":"ciroc_redberry","name":"C√Æroc Red Berry","price":49.0}
    ],
    "whisky": [
      {"id":"william_peel","name":"William Peel","price":29.0},
      {"id":"label_5","name":"Label 5 Classic Black","price":32.0},
      {"id":"ballantines","name":"Ballantine‚Äôs Finest","price":36.0},
      {"id":"jack_old7","name":"Jack Daniel‚Äôs Old No.7","price":40.0},
      {"id":"jack_honey","name":"Jack Daniel‚Äôs Tennessee Honey","price":42.0}
    ],
    "rhum": [
      {"id":"old_nick_darkwood","name":"Old Nick Dark Wood","price":29.0},
      {"id":"captain_morgan","name":"Captain Morgan Spiced Gold","price":34.0},
      {"id":"havana_especial","name":"Havana Club Especial","price":38.0},
      {"id":"old_nick_blanc","name":"Old Nick Rhum Blanc","price":27.0},
      {"id":"saint_james_blanc","name":"Saint James Rhum Blanc","price":32.0},
      {"id":"trois_rivieres","name":"Trois Rivi√®res Rhum Blanc","price":33.0},
      {"id":"havana_3ans","name":"Havana Club 3 ans","price":37.0}
    ],
    "liqueurs": [
      {"id":"get_27","name":"GET 27","price":32.0}
    ],
    "gin": [
      {"id":"gibson_gin","name":"Gibson‚Äôs Gin","price":34.0},
      {"id":"gordons_gin","name":"Gordon‚Äôs Gin","price":34.0}
    ],
    "tequila": [
      {"id":"tequila_sanjose","name":"Tequila San Jos√©","price":28.0}
    ],
    "pastis": [
      {"id":"ricard","name":"Ricard","price":35.0},
      {"id":"pastis_51","name":"Pastis 51","price":35.0}
    ],
    "vin": [
      {"id":"xv_catalan_rose","name":"XV Catalan Ros√©","price":19.0},
      {"id":"xv_catalan_blanc","name":"XV Catalan Blanc","price":19.0},
      {"id":"xv_catalan_rouge","name":"XV Catalan Rouge","price":19.0},
      {"id":"muscat","name":"Muscat","price":25.0}
    ],
    "softs": [
      {"id":"oasis_tropical","name":"Oasis (tropical)","price":3.5},
      {"id":"fanta_citron","name":"Fanta citron","price":3.5},
      {"id":"schweppes_tonic","name":"Schweppes tonic","price":3.5},
      {"id":"perrier_citron","name":"Perrier citron","price":2.5},
      {"id":"crazy_tiger","name":"Crazy Tiger","price":5.0},
      {"id":"jus_pommes","name":"Jus de pommes","price":4.5},
      {"id":"jus_oranges","name":"Jus d'oranges","price":4.5},
      {"id":"jus_ananas","name":"Jus d'ananas","price":4.5}
    ],
    "accessoires": [
      {"id":"verre_whisky","name":"Verre √† whisky","price":0.5}
    ]
  };

  // ====== STOCK AVAIL (alcool seulement) ======
  let stockAvail = {}; // { id: true/false }
  async function loadStockAvail(){
    try{
      const res = await fetch(STOCK_SNAPSHOT_URL, { cache:"no-store" });
      if(!res.ok) throw new Error("HTTP "+res.status);
      const snap = await res.json();

      // snap attendu : { items: { <id>: { qty:number } } } OU { <id>: number } etc.
      // On rend √ßa robuste :
      const out = {};
      if(snap && typeof snap === "object"){
        if(snap.items && typeof snap.items === "object"){
          Object.entries(snap.items).forEach(([id, v])=>{
            const qty = (v && typeof v==="object") ? Number(v.qty ?? v.qte ?? v.stock ?? 0) : Number(v);
            out[id] = qty > 0;
          });
        } else {
          Object.entries(snap).forEach(([id, v])=>{
            const qty = (v && typeof v==="object") ? Number(v.qty ?? v.qte ?? v.stock ?? 0) : Number(v);
            if(typeof id === "string") out[id] = qty > 0;
          });
        }
      }
      stockAvail = out;
    }catch(e){
      // Si stock indispo: on n'affiche pas rupture/dipo pour alcool (reste neutre)
      stockAvail = {};
    }
  }

  // ====== HELPERS ======
  function imgUrlForId(id){
    return `${STOCK_IMG_BASE}${encodeURIComponent(id)}.png`;
  }
  function catLabel(cat){
    const map = {snacks:"Snacks",vodka:"Vodka",whisky:"Whisky",rhum:"Rhum",liqueurs:"Liqueurs",gin:"Gin",tequila:"Tequila",softs:"Softs",pastis:"Pastis",vin:"Vin",accessoires:"Accessoires"};
    return map[cat] || cat;
  }

  function flattenProducts(){
    const out = [];
    Object.entries(products).forEach(([cat, list]) => list.forEach(p => {
      const id = p.id || "";
      const isAlcohol = ALCOHOL_CATS.has(cat);
      const available = isAlcohol ? !!stockAvail[id] : null;
      out.push({ ...p, id, category: cat, isAlcohol, available, imageUrl: id ? imgUrlForId(id) : "" });
    }));
    return out;
  }

  function getProductsForCategory(category){
    if(category === "all") return flattenProducts();
    return (products[category] || []).map(p => {
      const id = p.id || "";
      const isAlcohol = ALCOHOL_CATS.has(category);
      const available = isAlcohol ? !!stockAvail[id] : null;
      return ({ ...p, id, category, isAlcohol, available, imageUrl: id ? imgUrlForId(id) : "" });
    });
  }

  function applySearch(list, term){
    const t = (term || "").trim().toLowerCase();
    if(!t) return list;
    return list.filter(p => (p.name || "").toLowerCase().includes(t));
  }

  // ====== RENDER ======
  const gridEl = document.getElementById("grid");
  const resultInfoEl = document.getElementById("resultInfo");
  const tabsEl = document.getElementById("categoryTabs");
  const searchEl = document.getElementById("searchInput");

  let currentCategory = "all";
  let currentSearch = "";

  function render(){
    const list0 = getProductsForCategory(currentCategory);
    const list = applySearch(list0, currentSearch);

    resultInfoEl.textContent = `${list.length} article${list.length>1?"s":""} ‚Ä¢ ${currentCategory==="all"?"Tout":catLabel(currentCategory)}`;

    gridEl.innerHTML = "";
    list.forEach(p => {
      const card = document.createElement("div");
      card.className = "card";

      const top = document.createElement("div");
      top.className = "topLine";

      const cat = document.createElement("div");
      cat.textContent = catLabel(p.category);

      const badge = document.createElement("div");
      badge.className = "badge";

      if(p.isAlcohol){
        const dot = document.createElement("span");
        dot.className = "dot " + (p.available ? "ok" : "ko");
        const txt = document.createElement("span");
        txt.textContent = p.available ? "Disponible" : "Rupture";
        badge.classList.add(p.available ? "ok" : "ko");
        badge.appendChild(dot);
        badge.appendChild(txt);
      } else {
        // pas de dispo pour snacks/softs/accessoires
        badge.classList.add("hidden");
      }

      top.appendChild(cat);
      top.appendChild(badge);

      const imgWrap = document.createElement("div");
      imgWrap.className = "imgWrap";
      const img = document.createElement("img");
      img.loading = "lazy";
      img.alt = p.name || "";
      img.src = p.imageUrl || "";
      img.onerror = () => { img.style.opacity = "0.25"; };
      imgWrap.appendChild(img);

      const name = document.createElement("div");
      name.className = "name";
      name.textContent = p.name || "";

      const price = document.createElement("div");
      price.className = "price";
      const val = document.createElement("span");
      val.textContent = (typeof p.price === "number") ? p.price.toFixed(2) : "";
      const eur = document.createElement("span");
      eur.className = "eur";
      eur.textContent = "‚Ç¨";
      price.appendChild(val);
      price.appendChild(eur);

      const btn = document.createElement("button");
      btn.className = "btn";
      btn.innerHTML = `
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6.62 10.79a15.053 15.053 0 0 0 6.59 6.59l2.2-2.2a1 1 0 0 1 1.01-.24c1.12.37 2.33.57 3.58.57a1 1 0 0 1 1 1V20a1 1 0 0 1-1 1C10.85 21 3 13.15 3 3a1 1 0 0 1 1-1h3.5a1 1 0 0 1 1 1c0 1.25.2 2.46.57 3.58a1 1 0 0 1-.24 1.01l-2.2 2.2z"/></svg>
        Commander
      `;
      btn.onclick = () => {
        // Ici tu peux mettre ton tel en dur si tu veux:
        // window.location.href = "tel:+33652336461";
        alert("Appelle pour commander.");
      };

      card.appendChild(top);
      card.appendChild(imgWrap);
      card.appendChild(name);
      card.appendChild(price);
      card.appendChild(btn);

      gridEl.appendChild(card);
    });
  }

  // ====== EVENTS ======
  tabsEl.addEventListener("click", (e) => {
    const b = e.target.closest("button[data-category]");
    if(!b) return;
    [...tabsEl.querySelectorAll("button")].forEach(x => x.classList.remove("active"));
    b.classList.add("active");
    currentCategory = b.getAttribute("data-category") || "all";
    render();
  });

  searchEl.addEventListener("input", () => {
    currentSearch = searchEl.value || "";
    render();
  });

  // Modal open/close
  const overlay = document.getElementById("overlay");
  document.getElementById("openModal").addEventListener("click", async () => {
    overlay.classList.add("show");
    overlay.setAttribute("aria-hidden","false");
    await loadStockAvail();
    render();
  });
  document.getElementById("closeModal").addEventListener("click", () => {
    overlay.classList.remove("show");
    overlay.setAttribute("aria-hidden","true");
  });
  overlay.addEventListener("click", (e) => {
    if(e.target === overlay){
      overlay.classList.remove("show");
      overlay.setAttribute("aria-hidden","true");
    }
  });

  // Si tu veux pr√©charger direct sans bouton (optionnel), d√©-commente :
  // (async()=>{ overlay.classList.add("show"); await loadStockAvail(); render(); })();
</script>

</body>
</html>
