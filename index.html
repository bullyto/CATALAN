<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>L'ap√©ro catalan¬Æ</title>

  <!-- PWA / UI -->
  <meta name="theme-color" content="#8a0b0b">
  <meta name="background-color" content="#2a0a0c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Ap√©ro Catalan¬Æ">

  <!-- ‚úÖ Cache-busting -->
  <link rel="manifest" href="manifest.webmanifest?v=20251223">

  <!-- ‚úÖ icons locales -->
  <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32.png?v=20251223">
  <link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png?v=20251223">
  <link rel="icon" type="image/png" sizes="512x512" href="./icon-512.png?v=20251223">
  <link rel="apple-touch-icon" href="./icon-touch-apple.png?v=20251223">

  <!-- ‚úÖ Partage / preview -->
  <meta property="og:title" content="L'ap√©ro catalan¬Æ">
  <meta property="og:description" content="√âpicerie de nuit catalan ‚Ä¢ Livraison 7j/7 de 19h √† 6h ‚Ä¢ Appel direct">
  <meta property="og:image" content="./icon-512.png?v=20251223">
  <meta property="og:type" content="website">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="L'ap√©ro catalan¬Æ">
  <meta name="twitter:description" content="√âpicerie de nuit catalan ‚Ä¢ Livraison 7j/7 de 19h √† 6h ‚Ä¢ Appel direct">
  <meta name="twitter:image" content="./icon-512.png?v=20251223">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com/3.4.16"></script>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">

  <script>
  tailwind.config = {
    theme: {
      extend: {
        colors: { primary: '#C61910', secondary: '#FFB81C' },
        borderRadius: {
          'none': '0px','sm': '4px',DEFAULT: '8px','md': '12px','lg': '16px','xl': '20px',
          '2xl': '24px','3xl': '32px','full': '9999px','button': '8px'
        }
      }
    }
  }
  </script>

  <style>
    :where([class^="ri-"])::before { content: "\f3c2"; }
    .modal { opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
    .modal.active { opacity: 1; pointer-events: auto; }
    .tab-active { background:#C61910 !important; color:#fff !important; }
    .tab-idle { background:#f3f4f6 !important; color:#111827 !important; }

    /* ===== PWA FAUX CHARGEMENT (uniquement PWA install√©e) ===== */
    #pwaLoading {
      position: fixed;
      inset: 0;
      z-index: 999999;
      display: none; /* activ√© uniquement en mode PWA */
      opacity: 0;
      transition: opacity .18s ease; /* fondu-in court */
    }
    #pwaLoading.ready { opacity: 1; }
    #pwaLoading .pl-body{
      height:100%;
      overflow:hidden;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;
      background:
        radial-gradient(900px 650px at 50% 18%, rgba(255,211,107,.18), transparent 58%),
        radial-gradient(900px 650px at 20% 70%, rgba(177,15,21,.20), transparent 62%),
        radial-gradient(900px 650px at 80% 70%, rgba(242,178,51,.12), transparent 62%),
        linear-gradient(180deg, #5a1217, #2a0a0c 55%, #120406);
    }
    #pwaLoading .pl-stripes{
      position:absolute; inset:-40%;
      background: repeating-linear-gradient(90deg, rgba(177,15,21,.12) 0 42px, rgba(242,178,51,.10) 42px 84px);
      transform: rotate(-12deg);
      opacity:.35;
      animation: pl-drift 8s ease-in-out infinite;
      mix-blend-mode: overlay;
      pointer-events:none;
    }
    @keyframes pl-drift{
      0%,100%{transform: rotate(-12deg) translateX(-1.4%)}
      50%{transform: rotate(-12deg) translateX(1.4%)}
    }
    #pwaLoading .pl-vignette{
      position:absolute; inset:0;
      background: radial-gradient(circle at 50% 38%, transparent 35%, rgba(0,0,0,.50) 92%);
      pointer-events:none;
    }
    #pwaLoading .pl-screen{
      position:relative;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    #pwaLoading .pl-brand{
      position:absolute;
      top:18px;
      width:100%;
      text-align:center;
      font-weight:900;
      letter-spacing:.18em;
      color:rgba(255,244,223,.95);
      font-size:19px;
      text-shadow:0 6px 24px rgba(0,0,0,.45);
      user-select:none;
    }
    #pwaLoading .pl-brand sup{
      font-size:12px;
      margin-left:3px;
      vertical-align:text-top;
      letter-spacing:0;
    }
    #pwaLoading .pl-stack{
      width:min(420px, 100%);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:16px;
      transform: translateY(-10px);
    }
    #pwaLoading .pl-iconWrap{
      width:168px; height:168px;
      display:grid;
      place-items:center;
      border-radius:36px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 24px 95px rgba(0,0,0,.55);
      position:relative;
      animation: pl-float 3.2s ease-in-out infinite;
      backdrop-filter: blur(10px);
      overflow:hidden;
    }
    #pwaLoading .pl-iconWrap::before{
      content:"";
      position:absolute; inset:-20px;
      background: radial-gradient(circle at 50% 50%, rgba(255,211,107,.28), transparent 60%);
      filter: blur(16px);
      opacity:.9;
      pointer-events:none;
      z-index:0;
    }
    #pwaLoading .pl-iconWrap::after{
      content:"";
      position:absolute;
      top:-40%;
      left:-70%;
      width:60%;
      height:220%;
      background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,.18) 40%, rgba(255,255,255,.35) 50%, rgba(255,255,255,.18) 60%, transparent 100%);
      transform: skewX(-18deg);
      filter: blur(1px);
      opacity:.75;
      animation: pl-logoShine 3.6s ease-in-out infinite;
      pointer-events:none;
      z-index:2;
      mix-blend-mode: screen;
    }
    @keyframes pl-logoShine{
      0%   { left:-75%; opacity:0; }
      18%  { opacity:.85; }
      50%  { opacity:.75; }
      82%  { opacity:.85; }
      100% { left:125%; opacity:0; }
    }
    #pwaLoading .pl-icon{
      width:132px; height:132px;
      object-fit:contain;
      border-radius:30px;
      background:#fff;
      filter: drop-shadow(0 10px 26px rgba(0,0,0,.35));
      position:relative;
      z-index:1;
    }
    @keyframes pl-float{
      0%,100%{transform: translateY(0)}
      50%{transform: translateY(-5px)}
    }
    #pwaLoading .pl-progressRow{
      width:270px;
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:10px;
    }
    #pwaLoading .pl-percent{
      font-size:13px;
      color:rgba(255,255,255,.72);
      letter-spacing:.2px;
      user-select:none;
    }
    #pwaLoading .pl-track{
      width:100%;
      height:10px;
      border-radius:999px;
      background: rgba(255,255,255,.18);
      border: 1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    #pwaLoading .pl-bar{
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, #d98912, #f2b233, #ffd36b);
      transition: width .25s linear;
      box-shadow: 0 0 18px rgba(255,211,107,.18);
      position:relative;
    }
    #pwaLoading .pl-bar:after{
      content:"";
      position:absolute;
      top:-70%;
      left:-55%;
      width:46%;
      height:240%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.24), transparent);
      transform: skewX(-16deg);
      animation: pl-sweep 1.6s linear infinite;
      opacity:.65;
    }
    @keyframes pl-sweep{
      0%{left:-55%}
      100%{left:130%}
    }
    @media (prefers-reduced-motion: reduce){
      #pwaLoading .pl-stripes,
      #pwaLoading .pl-iconWrap,
      #pwaLoading .pl-iconWrap::after,
      #pwaLoading .pl-bar:after { animation:none !important; }
    }

    /* =========================
       üîû AGE GATE (harmonis√© Ap√©ro Catalan)
       - M√™me m√©thode que ton autre page (localStorage + until + action pending)
       ========================= */
    .ageOverlay{
      position: fixed;
      inset: 0;
      z-index: 999998; /* sous faux chargement, au-dessus du reste */
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      background: rgba(0,0,0,.72);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .ageOverlay.show{ display:flex; }

    .ageCard{
      width: min(560px, 94vw);
      border-radius: 24px;
      overflow: hidden;
      color: #fff;
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 30px 90px rgba(0,0,0,.55);
      background:
        radial-gradient(900px 650px at 50% 18%, rgba(255,211,107,.18), transparent 58%),
        radial-gradient(900px 650px at 20% 70%, rgba(198,25,16,.22), transparent 62%),
        radial-gradient(900px 650px at 80% 70%, rgba(255,184,28,.14), transparent 62%),
        linear-gradient(180deg, #5a1217, #2a0a0c 55%, #120406);
    }
    .ageTop{
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.02);
    }
    .ageBrand{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }
    .ageBadge{
      width: 36px;
      height: 36px;
      border-radius: 14px;
      display:grid;
      place-items:center;
      font-weight: 950;
      letter-spacing: .06em;
      background: rgba(198,25,16,.20);
      border: 1px solid rgba(198,25,16,.38);
      color: #fff;
      flex: 0 0 auto;
    }
    .ageBrand b{
      letter-spacing:.10em;
      text-transform: uppercase;
      font-size: 13px;
      color: rgba(255,244,223,.95);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .ageBody{ padding: 18px; }
    .ageTitle{ margin: 6px 0 10px; font-size: 28px; line-height:1.1; font-weight: 950; }
    .ageLead{ margin: 0 0 14px; color: rgba(255,255,255,.78); line-height: 1.45; font-size: 15px; }
    .ageNotice{
      margin: 14px 0 16px;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.92);
      font-size: 14px;
      line-height: 1.35;
    }
    .ageBtns{ display:grid; gap: 10px; margin-top: 10px; }
    .ageBtn{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: #fff;
      padding: 14px 14px;
      border-radius: 16px;
      cursor: pointer;
      font-weight: 950;
      font-size: 15px;
    }
    .ageBtnPrimary{
      background: linear-gradient(180deg, rgba(198,25,16,1), rgba(138,11,11,1));
      border-color: rgba(255,255,255,.10);
      box-shadow: 0 16px 48px rgba(198,25,16,.28);
    }
    .ageBtnSecondary{
      background: linear-gradient(180deg, rgba(255,184,28,1), rgba(217,137,18,1));
      color: #1b0b0b;
      border-color: rgba(255,255,255,.12);
      box-shadow: 0 16px 48px rgba(255,184,28,.22);
    }
    .ageTimer{
      margin-top: 12px;
      font-weight: 950;
      color: rgba(255,211,107,.95);
      text-align: center;
      font-size: 14px;
      letter-spacing: .2px;
    }
    .ageFine{
      margin: 12px 0 0;
      color: rgba(255,255,255,.62);
      font-size: 12.5px;
      line-height: 1.35;
      text-align: center;
    }
    .ageFine a{ color:#ffd36b; text-decoration:none; font-weight: 900; }
    .ageFine a:hover{ text-decoration: underline; }
  </style>
</head>

<body class="w-[375px] min-h-[762px] mx-auto relative"
  style="background-image:url('https://readdy.ai/api/search-image?query=blurred%20background%2C%20warm%20and%20festive%20atmosphere%2C%20people%20celebrating%2C%20soft%20lights%2C%20party%20mood%2C%20warm%20colors%2C%20subtle%20pattern%2C%20low%20opacity%20for%20text%20readability%2C%20no%20distinct%20objects&width=375&height=762&seq=10&orientation=portrait'); background-size:cover; background-position:center;">

<!-- ‚úÖ PWA : Faux chargement (uniquement si l'app est install√©e) -->
<div id="pwaLoading" aria-hidden="true">
  <div class="pl-body">
    <div class="pl-stripes"></div>
    <div class="pl-vignette"></div>

    <div class="pl-screen">
      <div class="pl-brand">APERO CATALAN<sup>¬Æ</sup></div>

      <div class="pl-stack">
        <div class="pl-iconWrap">
          <img class="pl-icon"
               src="./icon-512.png?v=20251223"
               onerror="this.onerror=null; this.src='https://image.noelshack.com/fichiers/2025/52/2/1766528997-icon-512-1.png';"
               alt="Ap√©ro Catalan">
        </div>

        <div class="pl-progressRow">
          <div class="pl-percent" id="plPct">0%</div>
          <div class="pl-track"><div class="pl-bar" id="plBar"></div></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* ===== Afficher le faux chargement UNIQUEMENT en PWA install√©e ===== */
(function(){
  const isStandalone =
    window.matchMedia('(display-mode: standalone)').matches ||
    window.matchMedia('(display-mode: fullscreen)').matches ||
    window.matchMedia('(display-mode: minimal-ui)').matches ||
    window.navigator.standalone === true;

  const overlay = document.getElementById('pwaLoading');
  if (!overlay) return;

  if (!isStandalone) {
    overlay.remove(); // Site navigateur => jamais de faux chargement
    return;
  }

  overlay.style.display = 'block';
  requestAnimationFrame(() => overlay.classList.add('ready'));

  const bar = document.getElementById('plBar');
  const pct = document.getElementById('plPct');
  let p = 0;

  function setP(v){
    p = Math.max(0, Math.min(100, v));
    if (bar) bar.style.width = p + '%';
    if (pct) pct.textContent = Math.round(p) + '%';
  }

  const t = setInterval(() => {
    if (p < 40) setP(p + 1.2);
    else if (p < 70) setP(p + 0.85);
    else if (p < 88) setP(p + 0.42);
    else if (p < 96) setP(p + 0.16);
    else setP(p + 0.05);
    if (p >= 99) setP(99);
  }, 5);

  window.addEventListener('load', () => {
    clearInterval(t);
    setTimeout(() => {
      setP(100);
      overlay.style.transition = 'opacity .25s ease';
      overlay.style.opacity = '0';
      setTimeout(() => overlay.remove(), 260);
    }, 2100);
  });
})();
</script>

<header class="fixed top-0 left-0 right-0 z-50 bg-white shadow-sm">
  <div class="w-[375px] mx-auto py-4 flex items-center justify-center">
    <div class="text-center">
      <div class="w-[150px] h-[150px] mx-auto mb-2 rounded-full overflow-hidden">
        <img id="logo-entreprise"
             src="https://i.postimg.cc/MHrNcvMr/file-000000002c906243b1fb58ce1bd6d82d-1.png"
             alt="Logo" class="w-full h-full object-cover">
      </div>
      <h1 class="font-['Pacifico'] text-2xl text-primary">L'ap√©ro catalan¬Æ</h1>
    </div>
  </div>
</header>

<main class="pt-[220px] pb-[80px] px-4 flex flex-col gap-6">
  <!-- ‚úÖ 1/4 bouton principal (APPELER) => d√©clenche l'age gate -->
  <a href="tel:0652336461"
     id="callBtn"
     class="w-full py-4 bg-primary text-white font-semibold !rounded-button flex items-center justify-center gap-2 cursor-pointer hover:opacity-90 transition-opacity">
    <div class="w-6 h-6 flex items-center justify-center">
      <i class="ri-phone-fill text-xl"></i>
    </div>
    <span>APPELER</span>
  </a>

  <!-- ‚úÖ 2/4 bouton principal (INSTALL) => d√©clenche l'age gate -->
  <button id="installBtn"
          class="w-full bg-[#FFC107] text-white py-4 !rounded-button font-semibold flex items-center justify-center gap-2 shadow-lg hover:opacity-95 transition hidden">
    <i class="ri-download-cloud-2-line text-xl"></i>
    AJOUTER √Ä L'√âCRAN D'ACCUEIL
  </button>
  <p id="installHint" class="text-xs text-white/90 text-center hidden">
    Sur iPhone : appuie sur <b>Partager</b> puis <b>Sur l‚Äô√©cran d‚Äôaccueil</b>.
  </p>

  <!-- ‚úÖ 3/4 bouton principal (ZONE) => d√©clenche l'age gate -->
  <button id="zoneBtn"
          class="w-full py-4 bg-secondary text-white font-semibold !rounded-button flex items-center justify-center gap-2 cursor-pointer hover:opacity-90 transition-opacity">
    <div class="w-6 h-6 flex items-center justify-center">
      <i class="ri-map-pin-2-fill text-xl"></i>
    </div>
    <span>ZONE DE LIVRAISON</span>
  </button>

  <!-- ‚úÖ 4/4 bouton principal (ARTICLES) => d√©clenche l'age gate -->
  <button id="articlesBtn"
          class="w-full py-4 bg-primary text-white font-semibold !rounded-button flex items-center justify-center gap-2 cursor-pointer hover:opacity-90 transition-opacity">
    <div class="w-6 h-6 flex items-center justify-center">
      <i class="ri-shopping-bag-fill text-xl"></i>
    </div>
    <span>NOS ARTICLES</span>
  </button>

  <div class="mt-6 p-4 bg-white/90 !rounded-button shadow-sm">
    <h3 class="text-lg font-semibold text-primary mb-3">Horaires & Zone de Livraison</h3>
    <ul class="space-y-2 text-sm">
      <li class="flex items-center gap-2">
        <i class="ri-time-line text-primary"></i>
        <span>Livraison 7j/7 de 19h √† 6h</span>
      </li>
      <li class="flex items-center gap-2">
        <i class="ri-map-pin-range-line text-primary"></i>
        <span>Jusqu'√† 30km de Perpignan</span>
      </li>
      <li class="flex items-center gap-2">
        <i class="ri-phone-line text-primary"></i>
        <span>Service rapide et professionnel</span>
      </li>
    </ul>
  </div>
</main>

<footer class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100">
  <div class="w-[375px] mx-auto py-4 px-4 flex items-center justify-center gap-6">
    <button id="cgvBtn" class="text-xs text-gray-500 hover:text-primary cursor-pointer">CGV</button>
    <button id="mentionsBtn" class="text-xs text-gray-500 hover:text-primary cursor-pointer">Mentions l√©gales</button>
  </div>
</footer>

<!-- ===== MODALS ===== -->
<div id="zoneModal" class="modal fixed inset-0 bg-black/70 z-50 flex items-center justify-center">
  <div class="w-[340px] bg-white !rounded-button p-4 relative">
    <button class="absolute right-4 top-4 w-6 h-6 flex items-center justify-center text-gray-500 hover:text-primary"
            onclick="closeModal('zoneModal')">
      <i class="ri-close-line text-xl"></i>
    </button>
    <h2 class="text-xl font-semibold mb-4">Zone de livraison</h2>
    <div class="h-[400px] bg-gray-100 !rounded-button overflow-hidden">
      <iframe src="https://www.google.com/maps/d/embed?mid=1FFuBFNnWrOdpTJQwUCoJsepVkpoYzcU&ehbc=2E312F" width="640" height="480"></iframe>
    </div>
  </div>
</div>

<div id="articlesModal" class="modal fixed inset-0 bg-black/70 z-50 flex items-center justify-center">
  <div class="w-[340px] bg-white !rounded-button p-4 relative max-h-[90vh] overflow-y-auto">
    <button class="absolute right-4 top-4 w-6 h-6 flex items-center justify-center text-gray-500 hover:text-primary"
            onclick="closeModal('articlesModal')">
      <i class="ri-close-line text-xl"></i>
    </button>

    <div class="pr-8">
      <h2 class="text-xl font-semibold mb-1">Nos Articles</h2>
      <p class="text-xs text-gray-500 mb-3">Recherche + tri pour trouver vite. Appelle pour commander.</p>
    </div>

    <div class="grid grid-cols-1 gap-2 mb-4">
      <div class="relative">
        <div class="w-6 h-6 absolute left-3 top-1/2 -translate-y-1/2 flex items-center justify-center text-gray-400">
          <i class="ri-search-line"></i>
        </div>
        <input type="text" id="searchInput" placeholder="Rechercher un produit..."
               class="w-full pl-10 pr-4 py-2 !rounded-button border border-gray-200 text-sm focus:outline-none focus:border-primary">
      </div>

      <div class="flex gap-2">
        <select id="sortSelect"
                class="w-full py-2 px-3 !rounded-button border border-gray-200 text-sm focus:outline-none focus:border-primary">
          <option value="popular">Tri : Recommand√©s</option>
          <option value="az">Tri : A ‚Üí Z</option>
          <option value="priceAsc">Tri : Prix ‚Üë</option>
          <option value="priceDesc">Tri : Prix ‚Üì</option>
        </select>
      </div>
    </div>

    <div class="overflow-x-auto -mx-4 px-4 mb-3">
      <div class="flex gap-2 whitespace-nowrap pb-2" id="categoryTabs">
        <button class="px-3 py-1 text-sm !rounded-full tab-active" data-category="all">Tout</button>
        <button class="px-3 py-1 text-sm !rounded-full tab-idle hover:bg-gray-200" data-category="vodka">üç∏ Vodka</button>
        <button class="px-3 py-1 text-sm !rounded-full tab-idle hover:bg-gray-200" data-category="whisky">ü•É Whisky</button>
        <button class="px-3 py-1 text-sm !rounded-full tab-idle hover:bg-gray-200" data-category="rhum">üè¥‚Äç‚ò†Ô∏è Rhum</button>
        <button class="px-3 py-1 text-sm !rounded-full tab-idle hover:bg-gray-200" data-category="liqueurs">üçπ Liqueurs</button>
        <button class="px-3 py-1 text-sm !rounded-full tab-idle hover:bg-gray-200" data-category="gin">üåø Gin</button>
        <button class="px-3 py-1 text-sm !rounded-full tab-idle hover:bg-gray-200" data-category="tequila">üåµ Tequila</button>
        <button class="px-3 py-1 text-sm !rounded-full tab-idle hover:bg-gray-200" data-category="softs">ü•§ Softs</button>
        <button class="px-3 py-1 text-sm !rounded-full tab-idle hover:bg-gray-200" data-category="pastis">üü° Pastis</button>
        <button class="px-3 py-1 text-sm !rounded-full tab-idle hover:bg-gray-200" data-category="champagne">üçæ Champagne</button>
        <button class="px-3 py-1 text-sm !rounded-full tab-idle hover:bg-gray-200" data-category="vin">üç∑ Vin</button>
        <button class="px-3 py-1 text-sm !rounded-full tab-idle hover:bg-gray-200" data-category="accessoires">üßä Accessoires</button>
      </div>
    </div>

    <div class="flex items-center justify-between text-xs text-gray-500 mb-3">
      <div id="resultInfo">‚Äî</div>
      <div class="text-gray-400">Commande : <span class="text-primary font-semibold">t√©l√©phone</span></div>
    </div>

    <div id="productGrid" class="grid grid-cols-2 gap-3"></div>

    <div class="mt-4 text-[11px] text-gray-500 leading-snug">
      Prix indicatifs ‚Ä¢ Le stock peut varier selon la nuit ‚Ä¢ Appelle pour confirmation et commande.
    </div>
  </div>
</div>

<div id="cgvModal" class="modal fixed inset-0 bg-black/70 z-50 flex items-center justify-center">
  <div class="w-[340px] bg-white !rounded-button p-4 relative max-h-[90vh] overflow-y-auto">
    <button class="absolute right-4 top-4 w-6 h-6 flex items-center justify-center text-gray-500 hover:text-primary"
            onclick="closeModal('cgvModal')">
      <i class="ri-close-line text-xl"></i>
    </button>
    <h2 class="text-xl font-semibold mb-4 bg-gradient-to-r from-primary to-secondary text-transparent bg-clip-text">
      Conditions G√©n√©rales de Vente
    </h2>
    <div class="prose text-sm space-y-4">
      <h3 class="font-medium">1. Service de livraison</h3>
      <p>L'Ap√©ro Catalan¬Æ propose un service de livraison d'alcool √† domicile, disponible de 19h √† 6h, 7 jours sur 7, dans un rayon de 30km autour de Perpignan.</p>
      <h3 class="font-medium">2. Commande et livraison</h3>
      <p>- Commande par t√©l√©phone uniquement<br>- D√©lai de livraison estim√© communiqu√© lors de la commande<br>- Zone de livraison limit√©e √† 30km de Perpignan</p>
      <h3 class="font-medium">3. Conditions de vente</h3>
      <p>- Vente d'alcool interdite aux mineurs (une pi√®ce d'identit√© sera demand√©e)<br>- Paiement √† la livraison (esp√®ces ou CB)<br>- Droit de refus en cas de client en √©tat d'√©bri√©t√© manifeste</p>
      <h3 class="font-medium">4. Prix et paiement</h3>
      <p>- Les prix sont indiqu√©s TTC<br>- Frais de livraison calcul√©s selon la distance<br>- Paiement s√©curis√© √† la livraison</p>
      <h3 class="font-medium">5. Responsabilit√©</h3>
      <p>L'Ap√©ro Catalan¬Æ se r√©serve le droit de refuser une livraison si les conditions de s√©curit√© ne sont pas r√©unies ou en cas de non-respect des pr√©sentes conditions.</p>
      <h3 class="font-medium">RGPD :</h3>
      <p>Nous collectons uniquement votre adresse et votre num√©ro de t√©l√©phone dans le but d‚Äôassurer la livraison de vos commandes et de vous envoyer des communications marketing par SMS. Ces donn√©es sont conserv√©es pendant une dur√©e maximale de 3 ans et ne sont pas utilis√©es √† d'autres fins. Aucun cookie n'est utilis√© sur notre site.</p>
    </div>
  </div>
</div>

<div id="mentionsModal" class="modal fixed inset-0 bg-black/70 z-50 flex items-center justify-center">
  <div class="w-[340px] bg-white !rounded-button p-4 relative max-h-[90vh] overflow-y-auto">
    <button class="absolute right-4 top-4 w-6 h-6 flex items-center justify-center text-gray-500 hover:text-primary"
            onclick="closeModal('mentionsModal')">
      <i class="ri-close-line text-xl"></i>
    </button>
    <h2 class="text-xl font-semibold mb-4 bg-gradient-to-r from-primary to-secondary text-transparent bg-clip-text">
      Mentions L√©gales
    </h2>
    <div class="prose text-sm space-y-4">
      <h3 class="font-medium text-base">√âditeur du site</h3>
      <p>Le pr√©sent site internet ¬´ L'Ap√©ro Catalan¬Æ ¬ª est exploit√© par la soci√©t√© Ap√©ro de Nuit 66¬Æ, entreprise immatricul√©e au Registre du Commerce et des Soci√©t√©s sous le num√©ro 879 976 099, dont le si√®ge social est situ√© a villelongue de la sallanque.</p>
      <h3 class="font-medium text-base">Responsable de publication</h3>
      <p>Monsieur Hauviller Steven, en qualit√© de repr√©sentant l√©gal de l'entreprise Ap√©ro de Nuit 66¬Æ.</p>
      <h3 class="font-medium text-base">Donn√©es personnelles & RGPD</h3>
      <p>Nous ne collectons pas de donn√©es personnelles via ce mini-site (pas de compte, pas de formulaire, pas de suivi).</p>
      <p>Si vous choisissez d‚Äôactiver les notifications push, l‚Äôabonnement est g√©r√© par votre navigateur/appareil. Vous pouvez vous d√©sabonner √† tout moment depuis les r√©glages de votre navigateur.</p>
      <h3 class="font-medium text-base">Propri√©t√©</h3>
      <p>¬´ L'Ap√©ro Catalan¬Æ ¬ª est une marque / vitrine commerciale exploit√©e par <b>Ap√©ro de Nuit 66¬Æ</b>.</p>
    </div>
  </div>
</div>

<!-- üîû AGE GATE OVERLAYS -->
<div class="ageOverlay" id="ageQuestion" role="dialog" aria-modal="true">
  <div class="ageCard">
    <div class="ageTop">
      <div class="ageBrand">
        <div class="ageBadge">18+</div>
        <b>L'AP√âRO CATALAN¬Æ</b>
      </div>
    </div>

    <div class="ageBody">
      <div class="ageTitle">Bienvenue ‚ú®</div>
      <p class="ageLead">
        Ce site pr√©sente des boissons alcoolis√©es. Pour continuer, confirme que tu as l‚Äô√¢ge l√©gal.
      </p>

      <div class="ageNotice">
        <b>La vente d‚Äôalcool est interdite aux mineurs.</b><br>
        L‚Äôabus d‚Äôalcool est dangereux pour la sant√©, √† consommer avec mod√©ration.
      </div>

      <div class="ageBtns">
        <button class="ageBtn ageBtnPrimary" id="ageYes">‚úÖ Je suis majeur</button>
        <button class="ageBtn ageBtnSecondary" id="ageNo">‚ÑπÔ∏è Je ne suis pas majeur</button>
      </div>

      <div class="ageFine">üîí Choix m√©moris√© sur cet appareil.</div>
    </div>
  </div>
</div>

<div class="ageOverlay" id="ageBlocked" role="dialog" aria-modal="true">
  <div class="ageCard">
    <div class="ageTop">
      <div class="ageBrand">
        <div class="ageBadge">NO</div>
        <b>ACC√àS R√âSERV√â</b>
      </div>
    </div>

    <div class="ageBody">
      <div class="ageTitle">Acc√®s r√©serv√© üîû</div>
      <p class="ageLead">
        Ce contenu est strictement r√©serv√© aux personnes majeures.<br>
        La vente d‚Äôalcool est interdite aux mineurs.
      </p>

      <div class="ageNotice">
        Pour acc√©der au contenu, une v√©rification d‚Äô√¢ge est obligatoire.
      </div>

      <!-- ‚úÖ (fix) compteur pr√©sent -->
      <div class="ageTimer">
        Nouvelle tentative dans <span id="ageCount">48:00:00</span>
      </div>

      <div class="ageFine">
        Si tu penses √™tre bloqu√© par erreur, contacte Ap√©ro de Nuit¬Æ (06.52.33.64.61)
        ou <a href="mailto:apero.nuit.du.66@gmail.com">contact@aperodenuit.com</a>.
      </div>
      <div class="ageFine" style="margin-top:10px;">
        L‚Äôabus d‚Äôalcool est dangereux pour la sant√©.
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const modals = {
    zoneModal: document.getElementById('zoneModal'),
    articlesModal: document.getElementById('articlesModal'),
    cgvModal: document.getElementById('cgvModal'),
    mentionsModal: document.getElementById('mentionsModal')
  };
  const buttons = {
    zoneBtn: document.getElementById('zoneBtn'),
    articlesBtn: document.getElementById('articlesBtn'),
    cgvBtn: document.getElementById('cgvBtn'),
    mentionsBtn: document.getElementById('mentionsBtn')
  };

  // ‚úÖ BI√àRES RETIR√âES
  // ‚úÖ VIN : DOMAINE DU VIEUX GENEVRIER remplac√© par XV Catalan
  const products = {
    "vodka": [
      {"name":"Poliakov","price":29.0,"image":""},
      {"name":"Absolut Vodka","price":34.0,"image":""},
      {"name":"CIROC Classic","price":49.0,"image":""},
      {"name":"CIROC Red Berry","price":49.0,"image":""},
      {"name":"CIROC Pomme","price":49.0,"image":""}
    ],
    "whisky": [
      {"name":"William Peel","price":29.0,"image":""},
      {"name":"LABEL 5","price":32.0,"image":""},
      {"name":"Clan Campbell","price":35.0,"image":""},
      {"name":"Ballantine's","price":36.0,"image":""},
      {"name":"Jack Daniel's","price":40.0,"image":""},
      {"name":"Jack Daniel's Honey","price":42.0,"image":""}
    ],
    "rhum": [
      {"name":"Old Nick","price":29.0,"image":""},
      {"name":"Old Nick (blanc)","price":27.0,"image":""},
      {"name":"Captain Morgan","price":34.0,"image":""},
      {"name":"Havana Club 3 ans","price":37.0,"image":""},
      {"name":"Havana Club","price":38.0,"image":""},
      {"name":"Saint James Rhum blanc","price":32.0,"image":""},
      {"name":"Trois Rivi√®res","price":33.0,"image":""}
    ],
    "liqueurs": [
      {"name":"GET 27","price":32.0,"image":""},
      {"name":"J√§germeister","price":35.0,"image":""},
      {"name":"COINTREAU","price":28.0,"image":""},
      {"name":"Gibson's","price":34.0,"image":""},
      {"name":"Liqueur de cassis","price":8.5,"image":""}
    ],
    "gin": [{"name":"Gordon's","price":34.0,"image":""}],
    "tequila": [{"name":"Tequila","price":28.0,"image":""}],
    "softs": [
      {"name":"Oasis (tropical)","price":3.5,"image":""},
      {"name":"Fanta citron","price":3.5,"image":""},
      {"name":"Schweppes tonic","price":3.5,"image":""},
      {"name":"Perrier citron","price":2.5,"image":""},
      {"name":"Crazy Tiger","price":5.0,"image":""},
      {"name":"Red Bull","price":3.5,"image":""},
      {"name":"Monster","price":2.4,"image":""},
      {"name":"Lait de coco","price":5.0,"image":""},
      {"name":"Jus de pommes","price":4.5,"image":""},
      {"name":"Jus de pamplemousse","price":4.5,"image":""},
      {"name":"Jus d'oranges","price":4.5,"image":""},
      {"name":"Jus d'ananas","price":4.5,"image":""}
    ],
    "pastis": [
      {"name":"Pastis de Marseille","price":35.0,"image":""},
      {"name":"Ricard","price":35.0,"image":""}
    ],
    "champagne": [
      {"name":"MO√ãT & CHANDON \"Imp√©rial\" (1,5 L)","price":89.0,"image":""},
      {"name":"Veuve Pelletier","price":60.0,"image":""}
    ],
    "vin": [
      {"name":"XV Catalan (Muscat)","price":25.0,"image":""},
      {"name":"XV Catalan (Vin rouge)","price":19.0,"image":""},
      {"name":"XV Catalan (Vin ros√©)","price":19.0,"image":""},
      {"name":"XV Catalan (Vin blanc)","price":19.0,"image":""},
      {"name":"LAFAGE (Vin blanc)","price":19.0,"image":""},
      {"name":"LAFAGE (Vin rouge)","price":19.0,"image":""},
      {"name":"LAFAGE (Vin ros√©)","price":19.0,"image":""}
    ],
    "accessoires": [{"name":"Verre √† whisky-soda incassable 35 cl","price":0.5,"image":""}]
  };

  // =========================
  // üîû AGE GATE (m√™me m√©thode)
  // D√©clench√© par les 4 boutons principaux
  // =========================
  const AGE = {
    KEY_UNTIL: "ad_major_until",
    KEY_LAST: "ad_last_choice",
    WEEK_MS: 20 * 24 * 60 * 60 * 1000,   // 20 jours (m√™me m√©thode que ton autre page)
    BLOCK_S: 48 * 60 * 60,              // 48h
  };

  const ageQuestion = document.getElementById("ageQuestion");
  const ageBlocked  = document.getElementById("ageBlocked");
  const ageYes      = document.getElementById("ageYes");
  const ageNo       = document.getElementById("ageNo");
  const ageCount    = document.getElementById("ageCount");

  let ageInterval = null;
  let agePendingAction = null;

  function ageNow(){ return Date.now(); }
  function ageGetUntil(){
    const v = localStorage.getItem(AGE.KEY_UNTIL);
    const n = v ? parseInt(v, 10) : 0;
    return Number.isFinite(n) ? n : 0;
  }
  function ageIsMajorValid(){ return ageGetUntil() > ageNow(); }

  function ageShow(el){
    el.classList.add("show");
    document.documentElement.style.overflow = "hidden";
    document.body.style.overflow = "hidden";
  }
  function ageHide(el){
    el.classList.remove("show");
    if(!ageQuestion.classList.contains("show") && !ageBlocked.classList.contains("show")){
      document.documentElement.style.overflow = "";
      document.body.style.overflow = "";
    }
  }
  function ageShowQuestion(){
    ageHide(ageBlocked);
    ageShow(ageQuestion);
  }
  function fmtHMS(totalSeconds){
    const s = Math.max(0, Math.floor(totalSeconds));
    const h = Math.floor(s / 3600);
    const m = Math.floor((s % 3600) / 60);
    const ss = s % 60;
    const pad = (x)=> String(x).padStart(2,"0");
    return `${pad(h)}:${pad(m)}:${pad(ss)}`;
  }
  function ageShowBlocked(){
    ageHide(ageQuestion);
    ageShow(ageBlocked);

    let t = AGE.BLOCK_S;
    if (ageCount) ageCount.textContent = fmtHMS(t);

    if(ageInterval) clearInterval(ageInterval);
    ageInterval = setInterval(() => {
      t--;
      if (ageCount) ageCount.textContent = fmtHMS(t);
      if(t <= 0){
        clearInterval(ageInterval);
        ageInterval = null;
        ageShowQuestion();
      }
    }, 1000);
  }
  function ageSetMajorWeek(){
    localStorage.setItem(AGE.KEY_LAST, "major");
    localStorage.setItem(AGE.KEY_UNTIL, String(ageNow() + AGE.WEEK_MS));
  }
  function ageSetMinor(){
    localStorage.setItem(AGE.KEY_LAST, "minor");
  }

  // Emp√™che ‚ÄúEscape‚Äù de fermer (m√™me logique que ta version)
  document.addEventListener("keydown", (e)=>{
    if((ageQuestion.classList.contains("show") || ageBlocked.classList.contains("show")) && e.key === "Escape"){
      e.preventDefault();
    }
  });

  function requireMajorThen(actionFn){
    if(ageIsMajorValid()){
      actionFn();
      return;
    }
    agePendingAction = actionFn;
    ageShowQuestion();
  }

  ageYes?.addEventListener("click", ()=>{
    ageSetMajorWeek();
    ageHide(ageQuestion);
    if(typeof agePendingAction === "function"){
      const fn = agePendingAction;
      agePendingAction = null;
      fn();
    }
  });

  ageNo?.addEventListener("click", ()=>{
    ageSetMinor();
    ageShowBlocked();
  });

  // =========================
  // MODALS (inchang√©)
  // =========================
  Object.entries(buttons).forEach(([key, btn]) => {
    const modalId = key.replace('Btn', 'Modal');
    btn.addEventListener('click', () => openModal(modalId));
  });

  window.closeModal = function(modalId) { modals[modalId].classList.remove('active'); };
  window.openModal = function(modalId) {
    modals[modalId].classList.add('active');
    if(modalId === 'articlesModal') displayProducts(getActiveCategory(), searchInput.value, sortSelect.value);
  };

  Object.values(modals).forEach(modal => {
    modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.remove('active'); });
  });

  const searchInput = document.getElementById('searchInput');
  const categoryTabs = document.getElementById('categoryTabs');
  const productGrid = document.getElementById('productGrid');
  const sortSelect = document.getElementById('sortSelect');
  const resultInfo = document.getElementById('resultInfo');

  const featuredOrder = [
    "Jack Daniel's","Ballantine's","Captain Morgan","Havana Club 3 ans","Absolut Vodka",
    "CIROC Classic","MO√ãT & CHANDON \"Imp√©rial\" (1,5 L)","Ricard","GET 27","Red Bull",
    "XV Catalan (Vin rouge)","XV Catalan (Vin blanc)","XV Catalan (Muscat)"
  ];

  function getActiveCategory() {
    const active = categoryTabs.querySelector('.tab-active');
    return active ? active.dataset.category : 'all';
  }
  function catLabel(cat){
    const map = {vodka:"Vodka",whisky:"Whisky",rhum:"Rhum",liqueurs:"Liqueurs",gin:"Gin",tequila:"Tequila",softs:"Softs",pastis:"Pastis",champagne:"Champagne",vin:"Vin",accessoires:"Accessoires"};
    return map[cat] || cat;
  }
  function flattenProducts() {
    const out = [];
    Object.entries(products).forEach(([cat, list]) => list.forEach(p => out.push({ ...p, category: cat })));
    return out;
  }
  function getProductsForCategory(category) {
    if (category === 'all') return flattenProducts();
    return (products[category] || []).map(p => ({ ...p, category }));
  }
  function applySearch(list, term) {
    const t = (term || "").trim().toLowerCase();
    if (!t) return list;
    return list.filter(p => p.name.toLowerCase().includes(t));
  }
  function applySort(list, mode) {
    const arr = [...list];
    if (mode === "az") arr.sort((a,b) => a.name.localeCompare(b.name, 'fr'));
    else if (mode === "priceAsc") arr.sort((a,b) => a.price - b.price);
    else if (mode === "priceDesc") arr.sort((a,b) => b.price - a.price);
    else {
      arr.sort((a,b) => {
        const ia = featuredOrder.indexOf(a.name), ib = featuredOrder.indexOf(b.name);
        const ra = ia === -1 ? 9999 : ia, rb = ib === -1 ? 9999 : ib;
        if (ra !== rb) return ra - rb;
        return a.name.localeCompare(b.name, 'fr');
      });
    }
    return arr;
  }

  function displayProducts(category, searchTerm = '', sortMode = 'popular') {
    const base = getProductsForCategory(category);
    const searched = applySearch(base, searchTerm);
    const sorted = applySort(searched, sortMode);

    productGrid.innerHTML = '';
    resultInfo.textContent = `${sorted.length} article${sorted.length>1?'s':''} ‚Ä¢ ${category==='all'?'Tout':catLabel(category)}`;

    sorted.forEach(product => {
      const card = document.createElement("div");
      card.className = "bg-white shadow-sm !rounded-button overflow-hidden flex flex-col border border-gray-100";
      card.innerHTML = `
        <div class="p-3 flex-1">
          <div class="text-[10px] inline-flex items-center px-2 py-[2px] rounded-full bg-gray-100 text-gray-600 mb-2">
            ${catLabel(product.category)}
          </div>
          <h3 class="font-semibold text-sm leading-snug mb-1 text-gray-900">${product.name}</h3>
          <p class="text-primary font-extrabold text-base">${product.price.toFixed(2)} ‚Ç¨</p>
        </div>
        <div class="px-3 pb-3">
          <a href="tel:0652336461" class="w-full inline-flex items-center justify-center gap-2 py-2 bg-primary text-white text-xs font-semibold !rounded-button hover:opacity-95 transition">
            <i class="ri-phone-fill"></i> Commander
          </a>
        </div>
      `;
      productGrid.appendChild(card);
    });
  }

  categoryTabs.addEventListener('click', (e) => {
    if (e.target.tagName === 'BUTTON') {
      categoryTabs.querySelectorAll('button').forEach(btn => { btn.classList.remove('tab-active'); btn.classList.add('tab-idle'); });
      e.target.classList.remove('tab-idle');
      e.target.classList.add('tab-active');
      displayProducts(e.target.dataset.category, searchInput.value, sortSelect.value);
    }
  });

  searchInput.addEventListener('input', () => displayProducts(getActiveCategory(), searchInput.value, sortSelect.value));
  sortSelect.addEventListener('change', () => displayProducts(getActiveCategory(), searchInput.value, sortSelect.value));

  displayProducts('all', '', 'popular');

  // =========================
  // ‚úÖ D√©clenche l'age gate sur les 4 boutons principaux
  // =========================
  const callBtn = document.getElementById('callBtn');
  const installBtnEl = document.getElementById('installBtn');
  const zoneBtnEl = document.getElementById('zoneBtn');
  const articlesBtnEl = document.getElementById('articlesBtn');

  callBtn?.addEventListener('click', (e) => {
    e.preventDefault();
    requireMajorThen(() => {
      window.location.href = callBtn.getAttribute('href') || 'tel:0652336461';
    });
  });

  // Zone + Articles : on emp√™che l'ouverture directe, et on ouvre apr√®s validation
  zoneBtnEl?.addEventListener('click', (e) => {
    e.preventDefault();
    requireMajorThen(() => openModal('zoneModal'));
  });

  articlesBtnEl?.addEventListener('click', (e) => {
    e.preventDefault();
    requireMajorThen(() => openModal('articlesModal'));
  });

  // Install : on laisse ensuite le code PWA g√©rer (on simule un clic apr√®s validation)
  installBtnEl?.addEventListener('click', (e) => {
    // IMPORTANT : on ne veut pas doubler le handler PWA plus bas.
    // Donc: on intercepte seulement si pas majeur.
    if (!ageIsMajorValid()) {
      e.preventDefault();
      e.stopImmediatePropagation();
      requireMajorThen(() => {
        // relance le clic une fois valid√©
        setTimeout(() => installBtnEl.click(), 0);
      });
    }
  }, true);
});
</script>

<!-- ‚úÖ Installation PWA (sans worker pour l‚Äôinstant) -->
<script>
let deferredPrompt = null;
const installBtn = document.getElementById('installBtn');
const installHint = document.getElementById('installHint');

function isIOS() { return /iphone|ipad|ipod/i.test(navigator.userAgent); }
function isInStandalone() {
  return window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;
}

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  if (!isInStandalone()) installBtn.classList.remove('hidden');
});

installBtn?.addEventListener('click', async () => {
  if (!deferredPrompt) return;
  installBtn.classList.add('hidden');
  deferredPrompt.prompt();
  try { await deferredPrompt.userChoice; } catch(e) {}
  deferredPrompt = null;
});

window.addEventListener('appinstalled', () => {
  deferredPrompt = null;
  installBtn?.classList.add('hidden');
});

window.addEventListener('load', () => {
  if (isIOS() && !isInStandalone()) {
    setTimeout(() => {
      installBtn.classList.remove('hidden');
      installBtn.addEventListener('click', () => {
        installHint.classList.remove('hidden');
      }, { once: true });
    }, 800);
  }
});
</script>

</body>
</html>
